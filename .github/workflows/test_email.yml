name: Test Email Alert

on:
  workflow_dispatch: # allows manual trigger
  schedule:
    - cron: '0 * * * *' # every hour at minute 0 (UTC)

jobs:
  send-test-email:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install smtplib certifi

      - name: Send test email
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          EMAIL_RECIPIENT: ${{ secrets.EMAIL_USER }}
        run: |
          python - <<EOF
import os
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import ssl
import certifi

sender_email = os.environ.get("EMAIL_USER")
sender_password = os.environ.get("EMAIL_PASS")
recipient_email = os.environ.get("EMAIL_RECIPIENT")

msg = MIMEMultipart("alternative")
msg["Subject"] = "ðŸŸ¢ Test Email - It Works!"
msg["From"] = sender_email
msg["To"] = recipient_email
body = "âœ… This is a test email from GitHub Actions. It works!"
msg.attach(MIMEText(body, "plain"))

context = ssl.create_default_context(cafile=certifi.where())
with smtplib.SMTP_SSL("smtp.gmail.com", 465, context=context) as server:
    server.login(sender_email, sender_password)
    server.send_message(msg)
print("ðŸ“¨ Test email sent successfully!")
EOF
